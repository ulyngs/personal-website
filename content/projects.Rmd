---
title: Projects
menu: main
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(knitr)
library(here)
library(lubridate)
library(googlesheets4)
gs4_deauth()

#### publications #####
publications <- read_sheet("https://docs.google.com/spreadsheets/d/1ta71CAGkcLqm-W1UdVRA_JJSddWV2TsrRZsCnQlmOis/edit?usp=sharing",
           sheet = "publications",
           col_types = "c") %>% 
  mutate(anchor = ifelse(is.na(short_title), 
                        janitor::make_clean_names(title),
                        janitor::make_clean_names(short_title)))

#### cv entries #####
cv_entries <- read_sheet("https://docs.google.com/spreadsheets/d/1ta71CAGkcLqm-W1UdVRA_JJSddWV2TsrRZsCnQlmOis/edit?usp=sharing",
           sheet = "cv_entries",
           col_types = "c")

#### projects ####
projects <- read_sheet("https://docs.google.com/spreadsheets/d/1ta71CAGkcLqm-W1UdVRA_JJSddWV2TsrRZsCnQlmOis/edit?usp=sharing",
           sheet = "projects")

```


```{r results='asis', echo=FALSE}
generate_project_row <- function(id){
  cat("<div class='row project-entries'>")
  
  teaser_type <- projects %>% 
    filter(project_id == id) %>% 
    pull(teaser_type)
  
  # add column with teaser
  teaser_path <- projects %>% 
    filter(project_id == id) %>% 
    pull(teaser_path)
  
  cat(str_c("<div class='col-lg-3 col-md-3'>",
            if_else(teaser_type == "image",
                    str_c("<img src=", teaser_path,
                          " class='img-fluid featured-work-graphic'/>"),
                    str_c("<div class='embed-responsive embed-responsive-16by9'>",
              "<iframe class='embed-responsive-item featured-work-graphic' src='",
              teaser_path, "' allowfullscreen></iframe></div>")),
            "</div>"))
   
  # open column with project entries
  cat("<div class='col-lg-9 col-md-9'>") 
  
  # add project title and description
  cur_project <- projects %>% 
    filter(project_id == id) %>% 
    mutate(html = str_c("<h3>", 
                        title, 
                        ifelse(is_current, 
                               " <span class='status-current'>[current]</span>",
                               " <span class='status-past'>[past]</span>"),
                        "</h3>", 
                        description))
  cat(cur_project$html)
  
  # add row with project work
  cat("<div class='row project-work'>")
  project_work <- publications %>% 
    filter(str_detect(project, id)) %>% 
      arrange(desc(date)) %>% 
      mutate(html = str_c("<div class='col-sm-4 project-work-entry'>",
                          "<p class='project-work-entry-title'>[**", title, "**](/publications/#", anchor, ")<br>",
                          authors_full, "<br>*", 
                          venue_abbrev, "*</div>" 
                          )
             )
  cat(project_work$html)
  cat("</div>")
  
  # close project entry column
  cat("</div>") 
  
  # close project row
  cat("</div>")
}

walk(projects$project_id, generate_project_row)

```


